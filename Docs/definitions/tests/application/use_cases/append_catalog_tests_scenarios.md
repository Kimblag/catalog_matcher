# Escenarios de tests – AppendCatalog

| Caso de test                                      | Escenario                                              | Setup (mocks)                                                                 | Entrada      | Comportamiento esperado                                      | Resultado esperado                                  |
| ------------------------------------------------ | ------------------------------------------------------ | ----------------------------------------------------------------------------- | ------------ | ------------------------------------------------------------ | --------------------------------------------------- |
| execute_when_valid_catalog_should_append_and_persist | Happy path                                             | Reader retorna items, Normalizer normaliza, Repo acepta save, Embedding OK     | `catalog.csv` | Orquesta lectura, normalización, persistencia y embeddings   | `save` y `vector_repository.save` llamados          |
| execute_when_file_is_empty_should_fail            | Archivo sin ítems                                      | FileReader retorna `[]`                                                       | `catalog.csv` | Valida catálogo vacío                                        | `EmptyCatalogFileException`                         |
| execute_when_normalizer_fails_should_propagate    | Error de normalización                                 | Normalizer lanza `CatalogNormalizationException`                               | `catalog.csv` | No captura excepción                                         | Excepción se propaga                                |
| execute_when_persisted_items_exist_should_merge   | Catálogo previo existente                              | Repo.get retorna ítems persistidos                                             | `catalog.csv` | Construye catálogo desde persistencia + nuevos ítems         | `save` recibe catálogo combinado                   |
| execute_when_items_exceed_batch_size_should_batch | Cantidad de ítems mayor a `BATCH_SIZE`                 | Normalizer retorna N > BATCH_SIZE                                              | `catalog.csv` | Procesa ítems por batches                                   | No falla y persiste correctamente                  |
| execute_should_generate_embeddings_for_all_items  | Creación de embeddings                                 | EmbeddingService retorna vector válido                                         | `catalog.csv` | Genera embedding por cada ítem del catálogo                  | `get_embedding` llamado N veces                    |
| execute_should_not_return_any_value               | Contrato del caso de uso                               | Setup válido                                                                  | `catalog.csv` | No retorna resultado                                         | `None`                                             |
